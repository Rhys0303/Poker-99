#include <iostream>
#include <vector>
#include <algorithm>
#include <ctime>
#include <cstdlib>

using namespace std;

struct Player {
    vector<int> hand;
    bool alive = true;
};

int main() {
    srand(time(0)); // è¨­å®šéš¨æ©Ÿç¨®å­

    vector<string> playerNames = {"ä½ ", "AI-Bob", "AI-Charlie", "AI-Diana"};
    vector<int> deck;
    
    // åˆå§‹åŒ–ç‰Œå † (1~13 å„ 4 å¼µ)
    for (int i = 1; i <= 13; ++i)
        for (int j = 0; j < 4; ++j)
            deck.push_back(i);
    random_shuffle(deck.begin(), deck.end());

    // åˆå§‹åŒ–ç©å®¶èˆ‡æ‰‹ç‰Œ
    vector<Player> players(4);
    for (int i = 0; i < 4; ++i)
        for (int j = 0; j < 5; ++j)
            players[i].hand.push_back(deck.back()), deck.pop_back();

    int total = 0, turn = 0, direction = 1;

    while (true) {
        if (!players[turn].alive) {
            turn = (turn + direction + 4) % 4;
            continue;
        }

        // å‹åˆ©æ¢ä»¶
        int aliveCount = 0, winner = -1;
        for (int i = 0; i < 4; ++i)
            if (players[i].alive) aliveCount++, winner = i;
        if (aliveCount == 1) {
            cout << "\nğŸ‰ æ­å–œ " << playerNames[winner] << " ç²å‹ï¼" << endl;
            break;
        }

        cout << "\n==============================" << endl;
        cout << "ç¸½åˆ†: " << total << "ï¼ˆ" << ((total > 0 && total <= 99) ? "æœ‰æ•ˆ" : "ç„¡æ•ˆ") << "ï¼‰"
             << "ï½œå‰©é¤˜ç‰Œæ•¸: " << deck.size() << endl;

        // é¡¯ç¤ºç©å®¶ç‹€æ…‹
        cout << "\nç©å®¶ç‹€æ…‹ï¼š" << endl;
        for (int i = 0; i < 4; ++i)
            cout << " - " << playerNames[i] << ": " << (players[i].alive ? "âœ…" : "âŒ") << endl;

        Player &p = players[turn];

        if (turn == 0) {
            // äººé¡ç©å®¶æ“ä½œ
            cout << "\nğŸ´ ä½ çš„æ‰‹ç‰Œï¼š" << endl;
            for (int i = 0; i < p.hand.size(); ++i)
                cout << "[" << i << "] " << p.hand[i] << "  ";
            cout << "\nğŸ‘‰ è«‹è¼¸å…¥è¦å‡ºçš„ç‰Œç´¢å¼•ï¼š";
            int c;
            cin >> c;

            if (c < 0 || c >= p.hand.size()) {
                cout << "âŒ è¼¸å…¥éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥ï¼" << endl;
                continue;
            }

            int card = p.hand[c];
            cout << "ğŸƒ ä½ å‡ºäº† " << card << " é»" << endl;

            // ç‰¹æ®Šå¡ç‰Œè™•ç†
            if (card == 1) total = 0;
            else if (card == 4) direction *= -1;
            else if (card == 5) {
                cout << "ğŸ¯ è«‹é¸æ“‡ä¸‹ä¸€ä½ç©å®¶å‡ºç‰Œï¼š" << endl;
                for (int i = 0; i < 4; ++i)
                    if (players[i].alive)
                        cout << "[" << i << "] " << playerNames[i] << "  ";
                cout << "\nğŸ‘‰ è¼¸å…¥ç·¨è™Ÿï¼š";
                int t; cin >> t;
                p.hand.erase(p.hand.begin() + c);
                if (!deck.empty()) p.hand.push_back(deck.back()), deck.pop_back();
                if (t == 0) continue;
                else { turn = t; continue; }
            }
            else if (card == 10 || card == 12) {
                cout << "â• è«‹é¸æ“‡åŠ (1)æˆ–æ¸›(0)ï¼š";
                int op; cin >> op;
                total += (op == 1 ? (card == 10 ? 10 : 20) : (card == 10 ? -10 : -20));
            }
            else if (card == 13) total = 99;
            else total += card;

            // å‡ºç‰Œå¾Œç§»é™¤ä¸¦è£œç‰Œ
            p.hand.erase(p.hand.begin() + c);
            if (!deck.empty()) p.hand.push_back(deck.back()), deck.pop_back();
        } else {
            // AI è‡ªå‹•å‡ºç‰Œ
            int c = 0;
            for (int i = 0; i < p.hand.size(); ++i) {
                int card = p.hand[i];
                int temp = total;
                if (card == 1) temp = 0;
                else if (card == 10 || card == 12) {
                    if (total + (card == 10 ? 10 : 20) <= 99)
                        temp += (card == 10 ? 10 : 20);
                    else
                        temp += (card == 10 ? -10 : -20);
                }
                else if (card == 13) temp = 99;
                else temp += card;

                if (temp <= 99) {
                    c = i;
                    break;
                }
            }

            int card = p.hand[c];
            cout << "ğŸ¤– " << playerNames[turn] << " å‡ºäº† " << card << " é»" << endl;

            if (card == 1) total = 0;
            else if (card == 4) direction *= -1;
            else if (card == 5) {
                for (int i = 1; i < 4; ++i) {
                    if (players[i].alive && i != turn) { turn = i; break; }
                }
                p.hand.erase(p.hand.begin() + c);
                if (!deck.empty()) p.hand.push_back(deck.back()), deck.pop_back();
                continue;
            }
            else if (card == 10 || card == 12) {
                if (total + (card == 10 ? 10 : 20) <= 99)
                    total += (card == 10 ? 10 : 20);
                else
                    total += (card == 10 ? -10 : -20);
            }
            else if (card == 13) total = 99;
            else total += card;

            p.hand.erase(p.hand.begin() + c);
            if (!deck.empty()) p.hand.push_back(deck.back()), deck.pop_back();
        }

        // çˆ†é»æª¢æŸ¥
        if (total > 99) {
            cout << "ğŸ’¥ " << playerNames[turn] << " çˆ†é»ï¼æ·˜æ±°å‡ºå±€ï¼" << endl;
            players[turn].alive = false;
        }

        // æ›ä¸‹ä¸€ä½ç©å®¶
        turn = (turn + direction + 4) % 4;
    }

    return 0;
}
