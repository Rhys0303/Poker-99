#include <iostream>
#include <vector>
#include <algorithm>
#include <random>
#include <chrono>
using namespace std;

struct Player {
    vector<int> hand;
    bool alive = true;
};

int main() {
    vector<string> playerNames = {"Alice", "Bob", "Charlie", "Diana"};
    vector<int> deck;
    for (int i = 1; i <= 13; ++i)
        for (int j = 0; j < 4; ++j)
            deck.push_back(i);

    unsigned seed = chrono::system_clock::now().time_since_epoch().count();
    shuffle(deck.begin(), deck.end(), default_random_engine(seed));

    vector<Player> players(4);
    int total = 0, turn = 0, direction = 1;

    for (int i = 0; i < 4; ++i)
        for (int j = 0; j < 5; ++j)
            players[i].hand.push_back(deck.back()), deck.pop_back();

    while (true) {
        if (!players[turn].alive) {
            turn = (turn + direction + 4) % 4;
            continue;
        }

        // æª¢æŸ¥æ˜¯å¦åªå‰©ä¸€ä½çŽ©å®¶
        int aliveCount = 0, winner = -1;
        for (int i = 0; i < 4; ++i)
            if (players[i].alive) aliveCount++, winner = i;
        if (aliveCount == 1) {
            cout << "ðŸŽ‰ æ­å–œ " << playerNames[winner] << " ç²å‹ï¼" << endl;
            break;
        }

        // é¡¯ç¤ºæ‰€æœ‰çŽ©å®¶ç‹€æ…‹
        cout << "\nðŸ‘¥ çŽ©å®¶ç‹€æ…‹ï¼š" << endl;
        for (int i = 0; i < 4; ++i)
            cout << " - " << playerNames[i] << ": " << (players[i].alive ? "âœ… å­˜æ´»" : "âŒ æ·˜æ±°") << endl;

        // é¡¯ç¤ºç¸½åˆ†èˆ‡ç‰Œå †ç‹€æ…‹
        cout << "\nðŸŽ¯ è¼ªåˆ° " << playerNames[turn] << " å‡ºç‰Œ" << endl;
        cout << "ðŸ”¢ ç•¶å‰ç¸½åˆ†: " << total 
             << "ï¼ˆ" << ((total > 0 && total <= 99) ? "æœ‰æ•ˆ" : "ç„¡æ•ˆ") << "ï¼‰"
             << "ï½œðŸƒ å‰©é¤˜ç‰Œæ•¸: " << deck.size() << endl;

        // é¡¯ç¤ºæ‰‹ç‰Œ
        cout << "ðŸŽ´ ä½ çš„æ‰‹ç‰Œï¼š" << endl;
        for (int i = 0; i < players[turn].hand.size(); ++i)
            cout << "[" << i << "] " << players[turn].hand[i] << "  ";
        cout << endl;

        // çŽ©å®¶é¸ç‰Œ
        int c;
        cout << "ðŸ‘‰ è«‹è¼¸å…¥è¦å‡ºçš„ç‰Œç´¢å¼•ï¼š";
        cin >> c;
        int card = players[turn].hand[c];
        cout << "ðŸƒ " << playerNames[turn] << " å‡ºäº† " << card << " é»ž" << endl;

        // è™•ç†ç‰¹æ®Šå¡ç‰Œ
        if (card == 1) total = 0;
        else if (card == 4) direction *= -1;
        else if (card == 5) {
            cout << "ðŸŽ¯ é¸æ“‡ä¸‹ä¸€ä½å‡ºç‰Œçš„çŽ©å®¶ï¼š" << endl;
            for (int i = 0; i < 4; ++i)
                if (players[i].alive) cout << "[" << i << "] " << playerNames[i] << "  ";
            cout << endl;
            int t;
            cin >> t;
            if (t == turn) {
                players[turn].hand.erase(players[turn].hand.begin() + c);
                if (!deck.empty()) players[turn].hand.push_back(deck.back()), deck.pop_back();
                cout << "ðŸŽ´ ä½ çš„æ‰‹ç‰Œï¼š" << endl;
                for (int i = 0; i < players[turn].hand.size(); ++i)
                    cout << "[" << i << "] " << players[turn].hand[i] << "  ";
                cout << endl;
                cin >> c;
                card = players[turn].hand[c];
            } else {
                turn = t;
                continue;
            }
        }
        else if (card == 10 || card == 12) {
            cout << "âž• è«‹é¸æ“‡åŠ (1)æˆ–æ¸›(0)ï¼š";
            int op;
            cin >> op;
            total += (op == 1 ? (card == 10 ? 10 : 20) : (card == 10 ? -10 : -20));
        }
        else if (card == 11) {
            turn = (turn + direction + 4) % 4;
        }
        else if (card == 13) total = 99;
        else total += card;

        // ç§»é™¤å·²å‡ºç‰Œä¸¦è£œç‰Œ
        players[turn].hand.erase(players[turn].hand.begin() + c);
        if (!deck.empty()) players[turn].hand.push_back(deck.back()), deck.pop_back();

        // åˆ¤æ–·æ˜¯å¦çˆ†é»ž
        if (total > 99) {
            cout << "ðŸ’¥ " << playerNames[turn] << " çˆ†é»žï¼æ·˜æ±°å‡ºå±€ï¼" << endl;
            players[turn].alive = false;
        }

        // æ›ä¸‹ä¸€ä½çŽ©å®¶
        turn = (turn + direction + 4) % 4;
    }

    return 0;
}
